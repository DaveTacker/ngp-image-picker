<div *ngIf="!loadImage" class="place-image">
  <div
    class="image-holder"
    [ngStyle]="{
      width: this.config.width,
      height: this.config.height,
      borderRadius: this.config.borderRadius
    }"
  >
    <button title="{{ labels['Upload a image'] }}" class="icon-btn image-upload-btn" (click)="onUpload($event)">
      <!--  <span class="material-icons">add_a_photo</mat-icon> -->
      <span class="material-icons">add_a_photo</span>
    </button>

    <input #imagePicker type="file" style="display: none" [id]="'filePicker-' + this.uuidFilePicker" (change)="handleFileSelect($event)" />
  </div>
</div>
<div *ngIf="loadImage" class="place-image">
  <div
    class="image-holder-loaded"
    [ngStyle]="{
      width: this.config.width,
      height: this.config.height,
      borderRadius: this.config.borderRadius
    }"
  >
    <img [src]="this.imageSrc" alt="image-loaded" [ngStyle]="{ borderRadius: this.config.borderRadius }" />
    <input #imagePicker type="file" style="display: none" [id]="'filePicker-' + this.uuidFilePicker" (change)="handleFileSelect($event)" />
  </div>
  <p
    *ngIf="this.calculateSize()"
    class="caption image-caption"
    [ngStyle]="{
      color: this.calculateSize() > 120 ? '#f44336' : 'unset',
      fontWeight: this.calculateSize() > 120 ? '500' : 'unset'
    }"
  >
    size: {{ this.calculateSize() }}Kb &nbsp; {{ this.format }}
  </p>

  <div style="flex-direction: row; box-sizing: border-box; display: flex; place-content: flex-start; align-items: flex-start" class="editing-bar-btn">
    <button class="icon-btn" id="upload-img" *ngIf="!this.config.hideAddBtn" title="{{ labels['Upload a image'] }}" (click)="onUpload($event)">
      <span class="material-icons">add_a_photo</span>
    </button>
    <button class="icon-btn" id="edit-img" *ngIf="!this.config.hideEditBtn" title="{{ labels['Open the editor panel'] }}" (click)="onOpenEditPanel()">
      <span class="material-icons">edit</span>
    </button>
    <a id="download-img" *ngIf="!this.config.hideDownloadBtn" title="{{ labels['Download the image'] }}" [href]="this.imageSrc" download="{{ imageName }}">
      <span class="material-icons">cloud_download</span>
    </a>
    <button class="icon-btn" id="delete-img" *ngIf="!this.config.hideDeleteBtn" title="{{ labels['Remove'] }}" (click)="onRemove()">
      <span class="material-icons">delete</span>
    </button>
  </div>
</div>

<div *ngIf="showEditPanel" id="popup" class="popup">
  <div style="flex-direction: row; box-sizing: border-box; display: flex; place-content: center flex-end; align-items: center">
    <button class="icon-btn" (click)="onCloseEditPanel()">
      <span class="material-icons">clear</span>
    </button>
  </div>

  <div class="image-container">
    <div class="image-holder-full">
      <img id="image-full" [src]="this.imageSrc" />

      <div id="image-croper" class="image-croper">
        <div id="image-croper-header">
          <mat-icon>drag_indicator</mat-icon>
        </div>
      </div>
    </div>

    <div class="control-panel">
      <p class="title-panel">{{ labels['Control Panel'] }}</p>

      <div style="display: flex; width: 100%; justify-content: space-between">
        <p class="item-panel">{{ labels['Quality'] }}</p>
        <p class="item-panel">{{ quality + '%' }}</p>
      </div>

      <div style="flex-direction: row; box-sizing: border-box; display: flex; place-content: flex-start; align-items: flex-start">
        <input
          class="input-range"
          (change)="onChangeQuality($event)"
          [ngStyle]="{ maxWidth: '100%', width: '100%', color: color }"
          [(ngModel)]="quality"
          type="range"
          min="1"
          max="100"
          value="50"
        />
      </div>

      <div class="item-panel" style="display: flex; width: 100%; justify-content: space-between">
        {{ labels['Max dimensions'] }}
        <div style="display: flex; align-items: center">
          <input type="checkbox" [(ngModel)]="maintainAspectRatio" [style.color]="color" />
          <span class="caption">{{ labels['aspect-ratio'] }}</span>
        </div>
      </div>

      <div style="margin-top: 8px !important; flex-flow: row wrap; box-sizing: border-box; display: flex; place-content: flex-start space-between; align-items: flex-start">
        <div class="form-field" style="max-width: 48%; width: 48%">
          <label>{{ labels['max-width(px)'] }}</label>
          <input (change)="onChangeSize(true, false)" placeholder="{{ labels['max-width(px)'] }}" [(ngModel)]="maxWidth" type="number" [min]="0" [max]="2000" />
        </div>

        <div class="form-field" style="max-width: 48%; width: 48%">
          <label>{{ labels['max-height(px)'] }}</label>
          <input (change)="onChangeSize(false, true)" placeholder="{{ labels['max-height(px)'] }}" [(ngModel)]="maxHeight" type="number" [min]="0" [max]="2000" />
        </div>
      </div>

      <!-- <div style="margin-top: 8px !important; flex-flow: row wrap; box-sizing: border-box; display: flex; place-content: flex-start space-between; align-items: flex-start">
        <mat-form-field class="no-input-style" style="max-width: 48%; width: 48%" appearance="fill">
          <mat-label>{{ labels['max-width(px)'] }}</mat-label>
          <input (change)="onChangeSize(true, false)" matInput placeholder="{{ labels['max-width(px)'] }}" [(ngModel)]="maxWidth" type="number" [min]="0" [max]="2000" />
        </mat-form-field>

        <mat-form-field class="no-input-style" style="max-width: 48%; width: 48%" appearance="fill">
          <mat-label>{{ labels['max-height(px)'] }}</mat-label>
          <input (change)="onChangeSize(false, true)" matInput placeholder="{{ labels['max-height(px)'] }}" [(ngModel)]="maxHeight" type="number" [min]="0" [max]="2000" />
        </mat-form-field>
      </div> -->

      <p class="item-panel">{{ labels['Format'] }}</p>
      <div style="margin-top: 8px !important; flex-direction: row; box-sizing: border-box; display: flex; place-content: flex-start; align-items: flex-start">
        <mat-form-field class="no-input-style" style="max-width: 100%; width: 100%" appearance="fill" [color]="color">
          <mat-select [(ngModel)]="format" (selectionChange)="onChangeFormat($event.value)">
            <mat-option *ngFor="let format of allFormats" [value]="format">
              {{ format }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <p>
        <mat-checkbox (change)="onCropStateChange()" [(ngModel)]="showCrop" [color]="color">
          <p class="item-panel">{{ labels['Crop'] }}</p>
        </mat-checkbox>
        <button style="float: right" [color]="color" (click)="onRestore()">
          <mat-icon> refresh </mat-icon>
        </button>
      </p>

      <ng-container *ngIf="showCrop">
        <div style="margin-top: 8px !important; flex-flow: row wrap; box-sizing: border-box; display: flex; place-content: flex-start space-between; align-items: flex-start">
          <mat-form-field class="no-input-style" style="max-width: 48%; width: 48%" appearance="fill">
            <mat-label>{{ labels['width(px)'] }}</mat-label>
            <input
              (change)="onChangeCrop($event.target.valueAsNumber)"
              matInput
              placeholder="{{ labels['width(px)'] }}"
              [(ngModel)]="cropWidth"
              type="number"
              [min]="0"
              [max]="2000"
            />
          </mat-form-field>
          <mat-form-field class="no-input-style" style="max-width: 48%; width: 48%" appearance="fill">
            <mat-label>{{ labels['height(px)'] }}</mat-label>
            <input
              (change)="onChangeCrop($event.target.valueAsNumber)"
              matInput
              placeholder="{{ labels['height(px)'] }}"
              [(ngModel)]="cropHeight"
              type="number"
              [min]="0"
              [max]="2000"
            />
          </mat-form-field>
        </div>

        <p style="margin-bottom: 4px !important">
          <button [color]="color" (click)="onCrop()">
            <mat-icon> crop </mat-icon>
          </button>
        </p>
      </ng-container>

      <div style="flex-direction: row; box-sizing: border-box; display: flex; place-content: center space-between; align-items: center">
        <button style="padding: 0px 8px; height: 34px; box-sizing: border-box; background-color: #fff; color: black" mat-flat-button (click)="onCloseEditPanel()">Guardar</button>

        <p
          *ngIf="this.calculateSize()"
          class="caption image-caption"
          [ngStyle]="{
            color: this.calculateSize() > 120 ? '#f44336' : 'unset',
            fontWeight: this.calculateSize() > 120 ? '500' : 'unset'
          }"
        >
          size: {{ this.calculateSize() }}Kb &nbsp; {{ this.format }}
        </p>
      </div>
    </div>
  </div>
</div>
